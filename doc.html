<html>
  <!-- Do not add doctype here, it breaks the css -->
  <head>
    <title>Thresholdmann documentation</title>
    <link
    rel="icon"
    sizes="any"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10'%3E%3Ccircle cx='5' cy='5' r='5' fill='LightPink'/%3E%3C/svg%3E"
   >

   <style>
    #menu {
      float: right;
      margin-right: 10px;
    }
    #menu img {
      margin-left: 15px;
    }
    .mui {
      font-family: "Montserrat", sans-serif;
      font-size: 14px;
      font-weight: 200;
    }
    #text-container{
      max-width: 700px;
      position: absolute;
      left: 50%;
      transform: translateX( -50% );
      margin-top: 20px;
    }
    .doc {
      font-family: "Roboto Mono", monospace;
      font-size: 14px;
      font-weight: 100;
      line-height: 1.5rem;
      text-indent: -0.5rem;
      color: white;
      text-align: left;
    }
    h1{
      font-family: "Roboto Mono", monospace;
      font-weight: 500;
    }
    img.button {
      width: 0.9rem;
      height: 0.9rem;
      margin: 8px 2px;
      vertical-align: middle;
      cursor: pointer;
    }
    img.button:hover {
      opacity: 0.5;
    }
    img.icon {
      width: 1rem;
      height: 1rem;
      margin: 4px 2px;
      vertical-align: middle;
      cursor: pointer;
    }
    </style>
  </head>

  <body>

    <div id="header">
      <!-- Top-right menu bar -->
      <div id="menu">
        <img id="doc" class="button" title="documentation" src="img/doc.svg"/>
        <a href="https://github.com/neuroanatomy/thresholdmann/issues" target="_blank"><img id="bug" class="button" title="report a bug" src="img/bug.svg"/></a>
        <a href="https://github.com/neuroanatomy/thresholdmann" target="_blank"><img id="github" class="button" title="join our github project" style="width:15px;height:15px" src="img/github.svg"/></a>
      </div>

      <!-- Left-top logo -->
      <div style="display:inline-block;margin:10px">
        <a href="/" style="text-decoration:none">
          <span style="font-family: 'Montserrat', sans-serif;color:white;font-size:24px">Thresholdmann</span>
        </a>
      </div>
    </div>


    <!-- Documentation -->
    <div id="text-container" style="display: flex">
      <div class="doc">
        <h1>Documentation</h1>
        <p>
          <b>Load & navigate data.</b> To load your data, simply drag and drop your nifti volume (.nii.gz or .nii) onto the upload box. Your MRI will appear in a stereotaxic viewer with an initial threshold mask overlayed. Navigate through slices using the slider below the viewer and switch view planes using the buttons.
        </p>
        <p>
          <b>Adjust threshold value.</b> Each local threshold can be adjusted in real time using its corresponding slider.
          The viewer is updated in real-time.
        </p>
        <p>
          <b>Select the direction of thresholding.</b> Depending on your imaging modality and the mask you would like to create, set the threshold direction according to the grey value gradient that fits your needs. 
          The viewer is updated in real-time.
        </p>
        <p>
          <b>Add control points.</b> The viewer is initialised with one control point at the center of the MRI volume. To add another control point, select the Add tool in the left panel (shortcut A), and click in the desired position in the viewer. This produces a space-varying threshold obtained through radial basis function interpolation. You can then adjust the local threshold.
        </p>
        <p>
          <b>Select a control point.</b> Click the Select tool in the left panel (shortcut S) and then in the viewer click on the control point you want to select. Its corresponding threshold slider will be selected automatically.
          Vice versa, selecting a slider will automatically select the corresponding control point and jump to the corresponding slice in the viewer. 
        </p>
        <p>
          <b>Remove a control point.</b> Select the Remove tool in the left panel (shortcut R) and then in the viewer click on the control point you want to remove.
        </p>
        <p>
          <b>Adjust mask opacity.</b> Select the opacity slider <img src="./img/alpha.svg" width="15px;"> in the left panel to change the opacity of the thresholded mask on the fly.
        </p>
        <p>
          <b>Adjust MRI contrast & brightness.</b> Select the contrast <img src="./img/adjust.svg" width="15px"> or brightness slider <img src="./img/sun-o.svg" width="15px"> in the left panel to interactively adjust contrast and brightness of the imaging data.
        </p>
        <p>
          <b>3D render.</b> Select the 3D render tool in the left panel to compute the 3D model of your mask on the fly and view it in an interactive 3D viewer. It will open in a separate browser window where you can zoom in and out and rotate the 3D object for inspection.
        </p>
        <p>
          <b>Saving.</b> Save the control points together with your mask nifti volume for a fully reproducible workflow.<br />
          <p2 style="font-weight: 400;">Save Control Points</p2> saves a list of the current control points to a json file.<br />
          <p2 style="font-weight: 400;">Save Mask</p2> saves the thresholded mask of the current MRI in nifti format. Depending on the size of your volume, the save may take a moment. The save progress is displayed below the viewer and you need to click "Download" once the popup appears in your browser window. (If you leave the window unattended, the save will disappear after a moment ðŸ™ƒ).
        </p>
        <p>
          <b>Load Control Points.</b> Load a list of control points from a json file. Please note that this replaces the current control points in case you placed some.
        </p>
        <p>
          <b>View Threshold Value.</b> Select Threshold value in the left panel to view the threshold value corresponding to the current mask. These volumes are updated in real time and can both be inspected interactively.<br />
        </p>
        <p>
          <b>Load new MRI file.</b> Simply reload the webpage to start working with a new MRI.<br />
        </p>
        <p>
          <b>Reproduce the workflow offline.</b> Once you downloaded the control points, you will be able to reproduce the thresholded mask volume using the <a href="https://github.com/neuroanatomy/thresholdmann/blob/master/thresholdmann.py" style="color:white;">thresholdmann.py</a>  script. It will take the source MRI, and the thresholdmann.json control points file to produce the mask volume, as in <br /><code style="font-family: 'Share Tech Mono';line-height:2.1">python thresholdmann.py input_nifti controlpoints_file output_nifti</code>.<br />
        </p>
        
        <img style="max-width:700px;padding-top:30px;padding-bottom:3px;padding-right:25px;" src="https://raw.githubusercontent.com/neuroanatomy/thresholdmann/master/img/thresholdmann_fig1_dark.png" alt=""/>
        <p style="padding-left:26px;padding-right:26px;font-size:12px;text-indent: 0rem;">
          <b>Thresholdmann interface and workflow.</b> Control points (blue dots) are added by clicking at the desired position in the viewer. This adds a slider to the right, which can be used to locally adapt the threshold. Progressively add control points to create a mask of the brain.<br />
        </p>
        <img style="max-width:700px;padding-top:30px;padding-bottom:3px;padding-left:25px;padding-right:25px;" src="https://raw.githubusercontent.com/neuroanatomy/thresholdmann/master/img/thresholdmann_fig2_dark.png" alt=""/>
        <p style="padding-left:26px;padding-right:26px;font-size:12px;text-indent: 0rem;">
          <b>Thresholdmann viewer.</b> Threshold mask and corresponding threshold value. These volumes are updated in real time and can both be inspected interactively. The set of control points and the mask can be downloaded.<br />
        </p>
        <img style="max-width:700px;padding-top:30px;padding-bottom:3px;padding-left:25px;padding-right:25px;" src="https://raw.githubusercontent.com/neuroanatomy/thresholdmann/master/img/thresholdmann_fig3_dark.png" alt=""/>
        <p style="padding-left:26px;padding-right:26px;font-size:12px;text-indent: 0rem;">
          <b>Thresholdmann result.</b> Download the mask created based on your set of control points. Make sure that the brain region was sufficiently disjoint from the rest of the head so that a mathematical morphology closing will be enough to completely separate it. This will give you a mask like shown in this image with its reconstructed surface as an example.<br /><br /><br />
        </p>

      </div>

    </div>



    <script src="https://cdn.jsdelivr.net/npm/jquery@3.1.1/dist/jquery.min.js"></script>
    <!-- <script>window.jQuery || document.write('<script src="http://localhost/libs/jquery/3.1.1/jquery.min.js"><\/script>')</script> -->

    <script src="https://cdn.jsdelivr.net/gh/r03ert0/muijs/mui.js"></script>
    <!-- <script>window.MUI || document.write('<script src="http://localhost/muijs/mui.js"><\/script>')</script> -->

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/r03ert0/muijs/mui.css" />
    <!-- <link rel="stylesheet" type="text/css" href="http://localhost/muijs/mui.css" /> -->

    <link rel="stylesheet" type="text/css" href="thresholdmann.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:100,500" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200" rel="stylesheet" />


    <script>
      initUI(MUI);
    </script>

  </body>
</html>
